<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teacher Dashboard</title>
    <style>
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .platform-tabs {
            margin-bottom: 20px;
        }
        .platform-tabs button {
            padding: 10px 20px;
            margin-right: 10px;
            cursor: pointer;
        }
        .platform-tabs button.active {
            background-color: #007bff;
            color: white;
            border: none;
        }
        #students-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }
        .student-card {
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 8px;
        }
        .error-message {
            color: red;
            padding: 20px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="platform-tabs">
            <button onclick="filterByPlatform('ALL')" class="active">ALL</button>
            <button onclick="filterByPlatform('WHATSAPP')">WHATSAPP</button>
            <button onclick="filterByPlatform('LINKED')">LINKED</button>
            <button onclick="filterByPlatform('ZOOM')">ZOOM</button>
        </div>
        <div id="students-container">
            <div class="error-message">Loading students...</div>
        </div>
    </div>

    <script>
        const SHEET_URL = 'https://docs.google.com/spreadsheets/d/1e2ppEZlcrZENPHMMyIAtNxqCvqHnxCl_FuR3NUX046I/export?format=csv';
        let studentsData = [];
        let currentPlatform = 'ALL';

        function showError(message) {
            const container = document.getElementById('students-container');
            container.innerHTML = `<div class="error-message">${message}</div>`;
        }

        function parseCSV(text) {
            return text.split('\n')
                .map(line => line.trim())
                .filter(line => line.length > 0)
                .map(line => {
                    const values = line.split(',').map(val => val.trim());
                    const data = {};
                    'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('').forEach((col, i) => {
                        if (i < values.length) data[col] = values[i];
                    });
                    return data;
                });
        }

        function displayStudents() {
            const container = document.getElementById('students-container');
            const filtered = studentsData.filter(student => {
                const isJeromeStudent = student['A']?.toLowerCase() === 'jerome';
                const matchesPlatform = currentPlatform === 'ALL' || 
                                      student['D']?.toUpperCase() === currentPlatform;
                return isJeromeStudent && matchesPlatform;
            });

            if (filtered.length === 0) {
                container.innerHTML = '<div class="error-message">No students found</div>';
                return;
            }

            const cards = filtered.map(student => `
                <div class="student-card">
                    <h3>${student['B'] || 'No Name'}</h3>
                    <p>Platform: ${student['D'] || 'Not specified'}</p>
                    ${student['K'] ? `<p>WhatsApp: ${student['K']}</p>` : ''}
                    ${student['L'] ? `<img src="${student['L']}" alt="Profile" style="max-width: 100px;">` : ''}
                </div>
            `).join('');

            container.innerHTML = cards;
        }

        function filterByPlatform(platform) {
            currentPlatform = platform;
            document.querySelectorAll('.platform-tabs button').forEach(btn => {
                btn.classList.toggle('active', btn.innerText === platform);
            });
            displayStudents();
        }

        async function init() {
            try {
                console.log('Fetching data from:', SHEET_URL);
                const response = await fetch(SHEET_URL);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                
                const text = await response.text();
                console.log('Data received, first 200 chars:', text.substring(0, 200));
                
                studentsData = parseCSV(text).slice(1); // Skip header row
                displayStudents();
            } catch (error) {
                console.error('Error:', error);
                showError(`Failed to load data: ${error.message}`);
            }
        }

        // Start loading when page is ready
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teacher Dashboard</title>
    <style>
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .platform-tabs {
            margin-bottom: 20px;
        }
        .platform-tabs button {
            padding: 10px 20px;
            margin-right: 10px;
            cursor: pointer;
        }
        .platform-tabs button.active {
            background-color: #007bff;
            color: white;
            border: none;
        }
        #students-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }
        .student-card {
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 8px;
        }
    </style>
</head>
<body>
        <div class="container">
        <div class="platform-tabs">
            <button onclick="filterByPlatform('ALL')" class="active">ALL</button>
            <button onclick="filterByPlatform('WHATSAPP')">WHATSAPP</button>
            <button onclick="filterByPlatform('LINKED')">LINKED</button>
            <button onclick="filterByPlatform('ZOOM')">ZOOM</button>
        </div>
        <div id="students-container"></div>
    </div>
    <script>
        const SHEET_URL = 'https://docs.google.com/spreadsheets/d/1e2ppEZlcrZENPHMMyIAtNxqCvqHnxCl_FuR3NUX046I/export?format=csv';
        let studentsData = [];
        let currentPlatform = 'ALL';

        function showError(message) {
            const container = document.getElementById('students-container');
            if (container) {
                container.innerHTML = `<div class="error-message" style="color: red; padding: 20px;">${message}</div>`;
            } else {
                console.error('Container not found:', message);
            }
        }

        // Load student data from Google Sheets
        async function loadStudentsData() {
            try {
                console.log('Fetching data from:', SHEET_URL);
                const response = await fetch(SHEET_URL);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const text = await response.text();
                console.log('Received data:', text.substring(0, 200));

                // Split into lines and remove empty ones
                const lines = text.split('\n')
                    .map(line => line.trim())
                    .filter(line => line.length > 0);

                // Convert CSV to array of objects
                studentsData = lines.slice(1).map(line => {
                    const values = line.split(',').map(val => val.trim());
                    const rowData = {};
                    'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('').forEach((key, index) => {
                        if (index < values.length) {
                            rowData[key] = values[index];
                        }
                    });
                    return rowData;
                });

                displayStudents();
            } catch (error) {
                console.error('Error loading student data:', error);
                showError(`Failed to load student data: ${error.message}`);
            }
        }

        function displayStudents() {
            const container = document.getElementById('students-container');
            if (!container) {
                console.error('Students container not found');
                return;
            }

            // Filter students for Jerome and current platform
            const filtered = studentsData.filter(student => {
                const isJeromeStudent = student['A']?.toLowerCase() === 'jerome';
                const matchesPlatform = currentPlatform === 'ALL' || student['D']?.toUpperCase() === currentPlatform;
                return isJeromeStudent && matchesPlatform;
            });

            if (filtered.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 20px;">No students found</div>';
                return;
            }

            // Create student cards
            const cards = filtered.map(student => `
                <div class="student-card">
                    <h3>${student['B'] || 'No Name'}</h3>
                    <p>Platform: ${student['D'] || 'Not specified'}</p>
                    ${student['K'] ? `<p>WhatsApp: ${student['K']}</p>` : ''}
                    ${student['L'] ? `<img src="${student['L']}" alt="Profile" style="max-width: 100px;">` : ''}
                </div>
            `).join('');

            container.innerHTML = cards;
        }

        function filterByPlatform(platform) {
            currentPlatform = platform;
            // Update active button
            document.querySelectorAll('.platform-tabs button').forEach(btn => {
                btn.classList.toggle('active', btn.innerText === platform);
            });
            displayStudents();
        }

        // Load data when page loads
        document.addEventListener('DOMContentLoaded', loadStudentsData);

        // Load student data from Google Sheets
        async function loadStudentsData() {
            try {
                console.log('Fetching data from:', SHEET_URL);
                const response = await fetch(SHEET_URL);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const text = await response.text();
                console.log('Received data:', text.substring(0, 200)); // Show first 200 chars
                
                // Split into lines and remove empty ones
                const lines = text.split('\n')
                    .map(line => line.trim())
                    .filter(line => line.length > 0);
                
                // Convert CSV to array of objects
                studentsData = lines.slice(1).map(line => {
                    // Handle quoted values properly
                    const values = [];
                    let currentValue = '';
                    let insideQuotes = false;
                    
                    for (let i = 0; i < line.length; i++) {
                        const char = line[i];
                        if (char === '"') {
                            insideQuotes = !insideQuotes;
                        } else if (char === ',' && !insideQuotes) {
                            values.push(currentValue.replace(/"/g, '').trim());
                            currentValue = '';
                        } else {
                            currentValue += char;
                        }
                    }
                    values.push(currentValue.replace(/"/g, '').trim());
                    
                    // Create object with letter keys
                    const columnKeys = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('');
                    const rowData = {};
                    values.forEach((value, index) => {
                        if (index < columnKeys.length) {
                            rowData[columnKeys[index]] = value;
                        }
                    });
                    return rowData;
                });
                
                // Filter for Jerome's students and display them
                displayStudents();
            } catch (error) {
                console.error('Error loading student data:', error);
                showError(`Failed to load student data: ${error.message}`);
            }
        }

        function displayStudents() {
            const container = document.getElementById('students-container');
            if (!container) {
                console.error('Students container not found');
                return;
            }

            // Filter students for Jerome and current platform
            const filtered = studentsData.filter(student => {
                const isJeromeStudent = student['A']?.toLowerCase() === 'jerome';
                const matchesPlatform = currentPlatform === 'ALL' || student['D']?.toUpperCase() === currentPlatform;
                return isJeromeStudent && matchesPlatform;
            });

            if (filtered.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 20px;">No students found</div>';
                return;
            }

            // Create student cards
            const cards = filtered.map(student => `
                <div class="student-card">
                    <h3>${student['B'] || 'No Name'}</h3>
                    <p>Platform: ${student['D'] || 'Not specified'}</p>
                    ${student['K'] ? `<p>WhatsApp: ${student['K']}</p>` : ''}
                    ${student['L'] ? `<img src="${student['L']}" alt="Profile" style="max-width: 100px;">` : ''}
                </div>
            `).join('');

            container.innerHTML = cards;
        }

        function filterByPlatform(platform) {
            currentPlatform = platform;
            // Update active button
            document.querySelectorAll('.platform-tabs button').forEach(btn => {
                btn.classList.toggle('active', btn.innerText === platform);
            });
            displayStudents();
        }

        // Load data when page loads
        document.addEventListener('DOMContentLoaded', loadStudentsData);
                    values.forEach((value, index) => {
                        rowData[String.fromCharCode(65 + index)] = value;
                    });
                    return rowData;
                });

                console.log('Loaded data:', studentsData); // Debug log
                
                // Show MIM platform by default if on students section
                if (document.querySelector('.section#students.active')) {
                    const mimBtn = document.querySelector('.platform-btn[data-platform="MIM"]');
                    if (mimBtn) {
                        showPlatform('MIM', mimBtn);
                    }
                }
            } catch (error) {
                console.error('Error loading student data:', error);
                document.querySelector('.students-grid').innerHTML = `
                    <div class="empty-message">
                        Error loading student data. Please try again later.
                    </div>
                `;
            }
        }

        // Show platform students
        function showPlatform(platform, element) {
            // Update platform buttons
            document.querySelectorAll('.platform-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            element.classList.add('active');

            const container = document.querySelector('.students-grid');
            
            // Filter students by both platform and teacher (Jerome)
            const platformStudents = studentsData.filter(student => {
                const isCorrectPlatform = student['D']?.trim().toUpperCase() === platform.toUpperCase();
                const isJeromeStudent = student['A']?.trim().toLowerCase() === 'jerome';
                return isCorrectPlatform && isJeromeStudent;
            });

            if (platformStudents.length === 0) {
                container.innerHTML = `
                    <div class="empty-message">
                        No ${platform} students currently assigned to Jerome.
                    </div>
                `;
                return;
            }

            container.innerHTML = platformStudents.map(student => {
                const isLinked = platform === 'Linked';
                const buttonsHtml = isLinked ? `
                    <div class="student-buttons ${isLinked ? 'three-buttons' : ''}">
                        <button class="student-btn" 
                                onclick="event.stopPropagation(); window.open('${student['K'] || '#'}', '_blank')">
                            WhatsApp
                        </button>
                        <button class="student-btn" 
                                onclick="event.stopPropagation(); window.open('${student['M'] || '#'}', '_blank')">
                            Call
                        </button>
                        <button class="student-btn" 
                                onclick="event.stopPropagation(); window.open('${student['Q'] || '#'}', '_blank')">
                            Timesheets
                        </button>
                    </div>
                ` : `
                    <div class="student-buttons">
                        <button class="student-btn" 
                                onclick="event.stopPropagation(); window.open('${student['K'] || '#'}', '_blank')">
                            WhatsApp
                        </button>
                        <button class="student-btn" 
                                onclick="event.stopPropagation(); window.open('${student['M'] || '#'}', '_blank')">
                            Call
                        </button>
                    </div>
                `;

                return `
                    <div class="student-card" onclick="window.open('${student['C'] || '#'}', '_blank')">
                        <img src="${student['L'] || `https://via.placeholder.com/60x60?text=${encodeURIComponent(student['B']?.charAt(0) || '?')}`}" 
                             alt="${student['B'] || 'Unknown'}" 
                             class="student-picture"
                             onerror="this.src='https://via.placeholder.com/60x60?text=${encodeURIComponent(student['B']?.charAt(0) || '?')}'"
                        >
                        <div class="student-name">${student['B'] || 'Unknown Student'}</div>
                        ${buttonsHtml}
                    </div>
                `;
            }).join('');
        }

        // Rest of your existing code...

    </script>
</body>
</html>